<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Controle de Período de Experiência</title>
    <!-- Carrega o Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Carrega a biblioteca SheetJS (xlsx.js) para ler arquivos .xlsx e .csv -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <!-- Carrega a fonte Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Define a fonte Inter como padrão */
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Esconde as setas do input de número */
        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        input[type="number"] {
            -moz-appearance: textfield;
        }
    </style>
</head>
<body class="bg-gray-100">

    <div class="container max-w-5xl mx-auto p-6 bg-white rounded-xl shadow-lg mt-10">
        
        <header class="text-center mb-8">
            <h1 class="text-3xl font-bold text-gray-800">Controle de Período de Experiência</h1>
            <p class="text-gray-600 mt-2">Adicione novos colaboradores e acompanhe quem está em treinamento.</p>
        </header>

        <!-- Formulário para Adicionar Colaborador -->
        <form id="add-employee-form" class="mb-8 p-6 bg-gray-50 border border-gray-200 rounded-lg">
            <h2 class="text-xl font-semibold mb-4 text-gray-700">Adicionar Novo Colaborador</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <!-- Campo Nome -->
                <div>
                    <label for="name" class="block text-sm font-medium text-gray-700 mb-1">Nome</label>
                    <input type="text" id="name" name="name" required
                           class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
                           placeholder="Ex: João da Silva">
                </div>
                <!-- Campo Função -->
                <div>
                    <label for="role" class="block text-sm font-medium text-gray-700 mb-1">Função</label>
                    <input type="text" id="role" name="role" required
                           class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
                           placeholder="Ex: Analista de Vendas">
                </div>
                <!-- Campo Data de Entrada -->
                <div>
                    <label for="start-date" class="block text-sm font-medium text-gray-700 mb-1">Data de Entrada</label>
                    <input type="date" id="start-date" name="start-date" required
                           class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
            </div>
            <div class="mt-6 text-right">
                <button type="submit"
                        class="px-8 py-3 bg-blue-600 text-white font-semibold rounded-lg shadow-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors duration-200">
                    Adicionar Colaborador
                </button>
            </div>
        </form>

        <!-- Formulário para Adicionar em Massa (Planilha) -->
        <form id="upload-csv-form" class="mb-8 p-6 bg-gray-50 border border-gray-200 rounded-lg">
            <h2 class="text-xl font-semibold mb-4 text-gray-700">Adicionar em Massa (Planilha)</h2>
            <p class="text-sm text-gray-600 mb-4">
                Carregue um arquivo <strong class="font-medium">.xlsx</strong> ou <strong class="font-medium">.csv</strong>.
                <br>As colunas devem ser: <strong class="font-medium">Coluna A: Nome</strong>, <strong class="font-medium">Coluna B: Função</strong>, <strong class="font-medium">Coluna C: Data (dd/mm/aaaa)</strong>.
            </p>
            <div class="flex flex-col sm:flex-row sm:items-end gap-4">
                <div class="flex-grow">
                    <label for="csv-file" class="block text-sm font-medium text-gray-700 mb-1">Arquivo da Planilha</label>
                    <input type="file" id="csv-file" name="csv-file" accept=".csv,.xlsx,.xls,application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet" required
                           class="w-full p-2 border border-gray-300 rounded-lg shadow-sm file:mr-4 file:py-2 file:px-4
                                  file:rounded-lg file:border-0 file:text-sm file:font-semibold
                                  file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100
                                  focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <button type="button" id="upload-csv-btn"
                        class="px-8 py-3 bg-green-600 text-white font-semibold rounded-lg shadow-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 transition-colors duration-200 flex-shrink-0">
                    Carregar Planilha
                </button>
            </div>
            <div id="upload-feedback" class="mt-4 text-sm font-medium"></div>
        </form>

        <!-- Abas de Navegação -->
        <div class="mb-6 border-b border-gray-200">
            <nav class="flex -mb-px" aria-label="Tabs">
                <button id="tab-training"
                        class="w-1/2 py-4 px-1 text-center border-b-2 font-medium text-sm text-blue-600 border-blue-600">
                    Em Treinamento (< 3 Meses)
                </button>
                <button id="tab-finished"
                        class="w-1/2 py-4 px-1 text-center border-b-2 font-medium text-sm text-gray-500 border-transparent hover:text-gray-700 hover:border-gray-300">
                    Experiência Finalizada (3+ Meses)
                </button>
            </nav>
        </div>

        <!-- Container das Listas -->
        <div id="lists-container">
            <!-- Lista de Colaboradores em Treinamento -->
            <div id="training-list-container">
                <div id="training-list" class="space-y-4">
                    <!-- Cards de colaboradores em treinamento serão inseridos aqui -->
                </div>
                <div id="training-empty" class="text-center p-10 text-gray-500" style="display: none;">
                    Nenhum colaborador em período de treinamento.
                </div>
            </div>

            <!-- Lista de Colaboradores com Experiência Finalizada -->
            <div id="finished-list-container" style="display: none;">
                <div id="finished-list" class="space-y-4">
                    <!-- Cards de colaboradores com experiência finalizada serão inseridos aqui -->
                </div>
                <div id="finished-empty" class="text-center p-10 text-gray-500" style="display: none;">
                    Nenhum colaborador finalizou o período de experiência.
                </div>
            </div>
        </div>

        <!-- Indicador de Carregamento (agora escondido por padrão) -->
        <div id="loading" class="text-center p-10 text-gray-500" style="display: none;">
            <svg class="animate-spin h-8 w-8 text-blue-600 mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            <p class="mt-4">Carregando dados...</p>
        </div>

    </div>

    <!-- Script de Lógica da Aplicação -->
    <script>
        // Variáveis Globais
        let employees = [];
        let currentTab = 'training';
        let appUpdateInterval = null; // Variável para controlar o intervalo
        const STORAGE_KEY = 'employeeTrackerData'; // Chave para o localStorage

        // Elementos do DOM
        const addForm = document.getElementById('add-employee-form');
        const nameInput = document.getElementById('name');
        const roleInput = document.getElementById('role');
        const startDateInput = document.getElementById('start-date');

        const tabTraining = document.getElementById('tab-training');
        const tabFinished = document.getElementById('tab-finished');
        
        const trainingListContainer = document.getElementById('training-list-container');
        const finishedListContainer = document.getElementById('finished-list-container');
        
        const trainingList = document.getElementById('training-list');
        const finishedList = document.getElementById('finished-list');
        
        const trainingEmpty = document.getElementById('training-empty');
        const finishedEmpty = document.getElementById('finished-empty');
        
        const loading = document.getElementById('loading');

        // Elementos do DOM para upload
        const uploadCsvForm = document.getElementById('upload-csv-form');
        const csvFileInput = document.getElementById('csv-file');
        const uploadCsvBtn = document.getElementById('upload-csv-btn');
        const uploadFeedback = document.getElementById('upload-feedback');


        /**
         * Converte data de dd/mm/aaaa para yyyy-mm-dd (ISO).
         */
        function convertDateToISO(dateString) {
            if (!dateString || typeof dateString !== 'string') return null;

            const parts = dateString.split('/');
            if (parts.length !== 3) return null; // Formato inválido

            const [day, month, year] = parts;
            
            // Verificação simples de formato (aceita anos com 2 ou 4 dígitos)
            if (day.length < 1 || day.length > 2 || month.length < 1 || month.length > 2 || year.length < 2 || year.length > 4) return null;

            // Garante 2 dígitos para dia/mês e 4 para ano
            const formattedDay = day.padStart(2, '0');
            const formattedMonth = month.padStart(2, '0');
            const formattedYear = year.length === 2 ? `20${year}` : year;


            const isoDate = `${formattedYear}-${formattedMonth}-${formattedDay}`;
            
            // Testa se a data ISO criada é válida
            const testDate = new Date(isoDate + 'T00:00:00');
            if (isNaN(testDate.getTime())) {
                console.warn(`Data inválida ignorada: ${dateString}`);
                return null;
            }
            
            return isoDate; // yyyy-mm-dd
        }

        /**
         * Calcula o tempo de casa do colaborador.
         * Retorna um objeto com dias, meses e se está há menos de 3 meses.
         */
        function calculateTenure(startDateString) {
            // Adiciona T00:00:00 para evitar problemas de fuso horário
            const startDate = new Date(startDateString + 'T00:00:00');
            const today = new Date();
            
            // Zera a hora de 'today' para comparar apenas datas
            today.setHours(0, 0, 0, 0);

            // Calcula a data limite (3 meses após a entrada)
            const threeMonthsLater = new Date(startDate.getTime());
            threeMonthsLater.setMonth(threeMonthsLater.getMonth() + 3);

            const isLessThan3Months = today < threeMonthsLater;

            // Calcula a diferença em dias
            const diffTime = Math.abs(today.getTime() - startDate.getTime());
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

            // Calcula meses e dias para exibição
            let months = 0;
            let days = 0;
            
            let tempDate = new Date(startDate.getTime());
            while (tempDate < today) {
                let nextMonth = new Date(tempDate.getTime());
                nextMonth.setMonth(nextMonth.getMonth() + 1);
                
                if (nextMonth <= today) {
                    months++;
                    tempDate = nextMonth;
                } else {
                    break;
                }
            }

            const daysDiff = (today.getTime() - tempDate.getTime()) / (1000 * 60 * 60 * 24);
            days = Math.floor(daysDiff);

            // Ajuste para o primeiro dia
            if (diffTime === 0) {
                days = 0;
                months = 0;
            }
            
            if (months === 0 && days === 0 && diffTime > 0) {
                 days = diffDays; // Fallback se o cálculo de meses falhar
            }
            
            // Caso especial: hoje é o dia de início
             if (startDate.getTime() === today.getTime()) {
                days = 0;
                months = 0;
            }

            return {
                totalDays: diffDays,
                months,
                days,
                isLessThan3Months
            };
        }

        /**
         * Formata o tempo de casa para exibição.
         */
        function formatTenure(tenure) {
            if (tenure.months > 0) {
                return `${tenure.months} ${tenure.months > 1 ? 'meses' : 'mês'} e ${tenure.days} ${tenure.days > 1 ? 'dias' : 'dia'}`;
            }
            if (tenure.totalDays === 1) {
                return '1 dia';
            }
            // Caso do dia de início
            if (tenure.totalDays === 0) {
                return 'Hoje';
            }
            return `${tenure.totalDays} dias`;
        }

        /**
         * Renderiza a aplicação (listas e abas).
         */
        function renderApp() {
            // Esconde o loading
            loading.style.display = 'none';
            
            // Atualiza visibilidade das abas
            trainingListContainer.style.display = currentTab === 'training' ? 'block' : 'none';
            finishedListContainer.style.display = currentTab === 'finished' ? 'block' : 'none';

            // Atualiza estilo das abas
            if (currentTab === 'training') {
                tabTraining.classList.add('text-blue-600', 'border-blue-600');
                tabTraining.classList.remove('text-gray-500', 'border-transparent', 'hover:text-gray-700', 'hover:border-gray-300');
                tabFinished.classList.add('text-gray-500', 'border-transparent', 'hover:text-gray-700', 'hover:border-gray-300');
                tabFinished.classList.remove('text-blue-600', 'border-blue-600');
            } else {
                tabFinished.classList.add('text-blue-600', 'border-blue-600');
                tabFinished.classList.remove('text-gray-500', 'border-transparent', 'hover:text-gray-700', 'hover:border-gray-300');
                tabTraining.classList.add('text-gray-500', 'border-transparent', 'hover:text-gray-700', 'hover:border-gray-300');
                tabTraining.classList.remove('text-blue-600', 'border-blue-600');
            }

            // Limpa as listas
            trainingList.innerHTML = '';
            finishedList.innerHTML = '';

            const today = new Date();
            const isFriday = today.getDay() === 5; // 0=Domingo, 5=Sexta

            let trainingCount = 0;
            let finishedCount = 0;
            
            // Ordena os funcionários pela data de entrada (mais recentes primeiro)
            const sortedEmployees = [...employees].sort((a, b) => new Date(b.startDate) - new Date(a.startDate));

            sortedEmployees.forEach(emp => {
                const tenure = calculateTenure(emp.startDate);
                const tenureText = formatTenure(tenure);
                const formattedStartDate = new Date(emp.startDate + 'T00:00:00').toLocaleDateString('pt-BR');

                if (tenure.isLessThan3Months) {
                    // Colaborador EM TREINAMENTO
                    trainingCount++;
                    const card = document.createElement('div');
                    card.className = 'flex flex-wrap sm:flex-nowrap justify-between items-center p-5 bg-white border border-gray-200 rounded-lg shadow-sm';
                    
                    let trainingBadge;
                    if (isFriday) {
                        // SEXTA-FEIRA = DIA DE TREINAMENTO OBRIGATÓRIO
                        trainingBadge = `
                            <span class="inline-flex items-center px-4 py-1 rounded-full text-sm font-bold text-white bg-red-600 animate-pulse">
                                <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path></svg>
                                TREINAMENTO HOJE
                            </span>`;
                    } else {
                        trainingBadge = `
                            <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold text-yellow-800 bg-yellow-200">
                                Em Treinamento
                            </span>`;
                    }
                    
                    card.innerHTML = `
                        <div class="flex-grow mb-4 sm:mb-0">
                            <h3 class="text-lg font-bold text-gray-800">${emp.name}</h3>
                            <p class="text-sm text-gray-600">${emp.role}</p>
                            <p class="text-sm text-gray-500 mt-1">Entrada: ${formattedStartDate}</p>
                        </div>
                        <div class="flex flex-col items-start sm:items-end w-full sm:w-auto">
                            ${trainingBadge}
                            <p class="text-md font-semibold text-gray-700 mt-2">
                                Tempo de casa: ${tenureText}
                            </p>
                        </div>
                        <button data-id="${emp.id}" class="delete-btn ml-0 sm:ml-4 mt-4 sm:mt-0 flex-shrink-0 w-10 h-10 flex items-center justify-center bg-red-100 text-red-600 rounded-full hover:bg-red-200 transition-colors">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                        </button>
                    `;
                    trainingList.appendChild(card);

                } else {
                    // Colaborador com EXPERIÊNCIA FINALIZADA
                    finishedCount++;
                    const card = document.createElement('div');
                    card.className = 'flex flex-wrap sm:flex-nowrap justify-between items-center p-5 bg-white border border-gray-200 rounded-lg shadow-sm';
                    
                    card.innerHTML = `
                        <div class="flex-grow mb-4 sm:mb-0">
                            <h3 class="text-lg font-bold text-gray-800">${emp.name}</h3>
                            <p class="text-sm text-gray-600">${emp.role}</p>
                             <p class="text-sm text-gray-500 mt-1">Entrada: ${formattedStartDate}</p>
                        </div>
                        <div class="flex flex-col items-start sm:items-end w-full sm:w-auto">
                            <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold text-green-800 bg-green-200">
                                Experiência Concluída
                            </span>
                            <p class="text-md font-semibold text-gray-700 mt-2">
                                Tempo de casa: ${tenureText}
                            </p>
                        </div>
                        <button data-id="${emp.id}" class="delete-btn ml-0 sm:ml-4 mt-4 sm:mt-0 flex-shrink-0 w-10 h-10 flex items-center justify-center bg-red-100 text-red-600 rounded-full hover:bg-red-200 transition-colors">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                        </button>
                    `;
                    finishedList.appendChild(card);
                }
            });

            // Atualiza contagem nas abas
            tabTraining.innerText = `Em Treinamento (${trainingCount})`;
            tabFinished.innerText = `Experiência Finalizada (${finishedCount})`;
            
            // Exibe mensagens de "vazio" se necessário
            trainingEmpty.style.display = trainingCount === 0 ? 'block' : 'none';
            finishedEmpty.style.display = finishedCount === 0 ? 'block' : 'none';
        }

        /**
         * Salva a lista de colaboradores no localStorage.
         */
        function saveEmployees() {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(employees));
        }

        /**
         * Carrega a lista de colaboradores do localStorage.
         */
        function loadEmployees() {
            const employeesJSON = localStorage.getItem(STORAGE_KEY);
            if (employeesJSON) {
                employees = JSON.parse(employeesJSON);
            } else {
                employees = [];
            }
            renderApp(); // Renderiza com os dados carregados
        }

        /**
         * Adiciona um novo colaborador.
         */
        function handleAddEmployee(e) {
            e.preventDefault();
            
            const name = nameInput.value;
            const role = roleInput.value;
            const startDate = startDateInput.value;

            if (!name || !role || !startDate) {
                console.error("Por favor, preencha todos os campos.");
                return;
            }

            // Cria um novo objeto de colaborador
            const newEmployee = {
                id: crypto.randomUUID(), // Gera um ID único
                name,
                role,
                startDate,
                createdAt: new Date().toISOString()
            };

            // Adiciona ao array
            employees.push(newEmployee);

            // Salva no localStorage
            saveEmployees();

            // Atualiza a interface
            renderApp();

            // Limpa o formulário
            addForm.reset();
        }

        /**
         * Processa o arquivo de planilha (XLSX ou CSV).
         */
        async function handleUploadCSV(e) {
            e.preventDefault(); // Previne o envio do formulário
            
            const file = csvFileInput.files[0];

            if (!file) {
                uploadFeedback.textContent = 'Por favor, selecione um arquivo.';
                uploadFeedback.className = 'mt-4 text-sm font-medium text-red-600';
                return;
            }

            uploadFeedback.textContent = 'Processando arquivo...';
            uploadFeedback.className = 'mt-4 text-sm font-medium text-blue-600';

            // Usa FileReader para ler o arquivo (Excel ou CSV)
            const reader = new FileReader();
            
            reader.onload = async function(event) {
                const data = event.target.result;
                let workbook;
                
                try {
                    // Tenta ler o arquivo usando SheetJS
                    workbook = XLSX.read(data, { 
                        type: 'binary' // Lê como string binária
                    });
                } catch (readErr) {
                    console.error("Erro ao processar o arquivo:", readErr);
                    uploadFeedback.textContent = 'Falha ao processar o arquivo. Verifique se não está corrompido.';
                    uploadFeedback.className = 'mt-4 text-sm font-medium text-red-600';
                    return;
                }

                // Pega a primeira planilha do arquivo
                const sheetName = workbook.SheetNames[0];
                const worksheet = workbook.Sheets[sheetName];

                // Converte a planilha para um array de arrays
                const rows = XLSX.utils.sheet_to_json(worksheet, {
                    header: 1,
                    raw: false, // Queremos os valores formatados
                    dateNF: 'dd/mm/aaaa' // Formata datas para o padrão esperado
                });

                let addedCount = 0;
                let errorCount = 0;
                let newEmployees = []; // Array temporário para novos funcionários

                for (const row of rows) {
                    if (!row || row.length < 3) {
                        console.warn("Linha ignorada (vazia ou incompleta): ", row);
                        errorCount++;
                        continue;
                    }
                    
                    const name = row[0];
                    const role = row[1];
                    const startDateStr = row[2]; // Deve vir como 'dd/mm/aaaa'

                    // Converte a data para o formato yyyy-mm-dd
                    const isoDate = convertDateToISO(startDateStr);

                    if (name && role && isoDate) {
                        const newEmployee = {
                            id: crypto.randomUUID(),
                            name: String(name).trim(),
                            role: String(role).trim(),
                            startDate: isoDate,
                            createdAt: new Date().toISOString()
                        };
                        newEmployees.push(newEmployee);
                        addedCount++;
                    } else {
                        // Se isoDate for nulo, a linha é ignorada (pode ser o cabeçalho "Data")
                        console.warn("Linha ignorada (formato inválido ou dados faltando): ", row);
                        errorCount++;
                    }
                }

                // Adiciona os novos funcionários à lista principal
                employees = [...employees, ...newEmployees];

                // Salva a lista atualizada no localStorage
                saveEmployees();

                // Atualiza a interface
                renderApp();

                // Exibe o feedback
                uploadFeedback.textContent = `${addedCount} colaboradores adicionados com sucesso. ${errorCount} linhas falharam ou foram ignoradas (incluindo cabeçalhos).`;
                uploadFeedback.className = 'mt-4 text-sm font-medium text-green-700';
                
                // Limpa o input do arquivo
                uploadCsvForm.reset();
            };

            reader.onerror = function(ex) {
                console.error("Erro ao ler o arquivo:", ex);
                uploadFeedback.textContent = 'Erro ao ler o arquivo.';
                uploadFeedback.className = 'mt-4 text-sm font-medium text-red-600';
            };

            // Inicia a leitura do arquivo como string binária
            reader.readAsBinaryString(file);
        }

        /**
         * Deleta um colaborador.
         */
        function handleDeleteEmployee(e) {
            const deleteButton = e.target.closest('.delete-btn');
            if (!deleteButton) return;

            const id = deleteButton.dataset.id;
            
            // Filtra o array para remover o colaborador
            employees = employees.filter(emp => emp.id !== id);

            // Salva a lista atualizada
            saveEmployees();

            // Atualiza a interface
            renderApp();
        }

        /**
         * Troca a aba ativa.
         */
        function handleChangeTab(tab) {
            currentTab = tab;
            renderApp();
        }

        /**
         * Inicializa a aplicação.
         */
        function initApp() {
            // Carrega os dados do localStorage
            loadEmployees();

            // Limpa o intervalo anterior, se houver
            if (appUpdateInterval) {
                clearInterval(appUpdateInterval);
            }
            
            // Atualiza a interface a cada minuto para refletir
            // mudanças de data (novo dia, mudança de status, alerta de sexta-feira)
            appUpdateInterval = setInterval(() => {
                console.log("Atualizando interface (verificação de data)...");
                renderApp();
            }, 60000); // 60000ms = 1 minuto

            // --- Adiciona os Event Listeners ---

            // Listener do formulário
            addForm.addEventListener('submit', handleAddEmployee);

            // Listener do formulário de Upload (usando o botão)
            uploadCsvBtn.addEventListener('click', handleUploadCSV);

            // Listeners das abas
            tabTraining.addEventListener('click', () => handleChangeTab('training'));
            tabFinished.addEventListener('click', () => handleChangeTab('finished'));

            // Listeners de deleção (usando delegação de evento)
            trainingList.addEventListener('click', handleDeleteEmployee);
            finishedList.addEventListener('click', handleDeleteEmployee);
        }

        // --- Inicia a Aplicação ---
        document.addEventListener('DOMContentLoaded', initApp);

    </script>

</body>
</html>
